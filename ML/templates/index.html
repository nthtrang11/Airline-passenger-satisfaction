<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airline Passenger Satisfaction Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        * {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .main-container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 15px;
            max-width: 1800px;
            width: 100%;
            height: 96vh;
            animation: fadeIn 0.5s ease-in;
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            margin-bottom: 12px;
        }

        .header h1 {
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 3px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 0.8rem;
            opacity: 0.95;
            margin: 0;
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 2px solid #667eea;
            margin-bottom: 12px;
        }

        .nav-tabs .nav-link {
            color: #667eea;
            font-weight: 600;
            border: none;
            padding: 8px 20px;
            font-size: 0.9rem;
        }

        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
        }

        .form-content {
            height: 100%;
            overflow-y: auto;
            padding-right: 5px;
        }

        .form-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 3px;
            font-size: 0.75rem;
        }

        .form-control,
        .form-select {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 4px 8px;
            background-color: #f8fafc;
            color: #1a202c;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
            background-color: white;
        }

        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 10px 30px;
            font-size: 0.95rem;
            font-weight: 700;
            border-radius: 50px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-predict:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .section-title {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 2px solid #667eea;
            font-size: 0.9rem;
        }

        .result-box {
            margin-top: 10px;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .result-satisfied {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .result-dissatisfied {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            color: white;
        }

        .card {
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #e9ecef 100%);
            padding: 10px;
            margin-bottom: 0;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.15);
        }

        /* Star Rating Styles */
        .star-rating {
            display: flex;
            gap: 2px;
            margin-top: 3px;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            font-size: 1.1rem;
            color: #cbd5e0;
            transition: all 0.2s ease;
        }

        .star-rating label:hover,
        .star-rating label:hover~label,
        .star-rating input:checked~label {
            color: #fbbf24;
        }

        .mb-2 {
            margin-bottom: 0.4rem !important;
        }

        .bi-airplane-fill {
            font-size: 1.5rem;
            animation: fly 2s ease-in-out infinite;
        }

        @keyframes fly {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Compact row spacing */
        .row {
            margin-left: -4px;
            margin-right: -4px;
        }

        .row>* {
            padding-left: 4px;
            padding-right: 4px;
        }

        /* Custom scrollbar */
        .form-content::-webkit-scrollbar,
        .tab-content::-webkit-scrollbar {
            width: 6px;
        }

        .form-content::-webkit-scrollbar-track,
        .tab-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .form-content::-webkit-scrollbar-thumb,
        .tab-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        /* Batch Analysis Styles */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e9ecef 100%);
        }

        .upload-area:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #f8fafc 100%);
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            text-align: center;
        }

        .stats-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stats-card p {
            font-size: 0.85rem;
            margin: 0;
            opacity: 0.9;
        }

        .results-table {
            font-size: 0.75rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .results-table th {
            position: sticky;
            top: 0;
            background: #667eea;
            color: white;
            z-index: 10;
        }

        .badge-satisfied {
            background: #38ef7d;
        }

        .badge-dissatisfied {
            background: #ff6a00;
        }

        .services-container {
            max-height: calc(96vh - 200px);
            overflow-y: auto;
        }

        .services-container::-webkit-scrollbar {
            width: 5px;
        }

        .services-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .services-container::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="main-container">
        <div class="header">
            <h1><i class="bi bi-airplane-fill"></i> AIRLINE PASSENGER SATISFACTION PREDICTION</h1>
            <p class="mb-0">Predict satisfaction for single passenger or analyze batch data</p>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#single"><i class="bi bi-person"></i> Single
                    Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#batch"><i class="bi bi-file-earmark-spreadsheet"></i>
                    Batch Analysis</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Single Prediction Tab -->
            <div id="single" class="tab-pane fade show active">
                <div class="form-content">
                    <form id="predictionForm">
                        <div class="row">
                            <!-- Passenger Information -->
                            <div class="col-md-4">
                                <div class="card">
                                    <h4 class="section-title"><i class="bi bi-person-fill"></i> Passenger Info</h4>

                                    <div class="mb-2">
                                        <label class="form-label">Gender</label>
                                        <select class="form-select form-select-sm" id="gender" required>
                                            {% for g in genders %}
                                            <option value="{{ g }}">{{ g }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Customer Type</label>
                                        <select class="form-select form-select-sm" id="customerType" required>
                                            {% for ct in customer_types %}
                                            <option value="{{ ct }}">{{ ct }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Age</label>
                                        <input type="number" class="form-control form-control-sm" id="age" value="30"
                                            min="0" max="120" required>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Type of Travel</label>
                                        <select class="form-select form-select-sm" id="travelType" required>
                                            {% for tt in travel_types %}
                                            <option value="{{ tt }}">{{ tt }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Class</label>
                                        <select class="form-select form-select-sm" id="class" required>
                                            {% for c in classes %}
                                            <option value="{{ c }}">{{ c }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Flight Distance (km)</label>
                                        <input type="number" class="form-control form-control-sm" id="distance"
                                            value="500" min="0" required>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Departure Delay (min)</label>
                                        <input type="number" class="form-control form-control-sm" id="depDelay"
                                            value="0" min="0" required>
                                    </div>

                                    <div class="mb-2">
                                        <label class="form-label">Arrival Delay (min)</label>
                                        <input type="number" class="form-control form-control-sm" id="arrDelay"
                                            value="0" min="0" required>
                                    </div>
                                </div>
                            </div>

                            <!-- In-flight Services Col 1 -->
                            <div class="col-md-4">
                                <div class="card">
                                    <h4 class="section-title"><i class="bi bi-star-fill"></i> Services (Part 1)</h4>
                                    <div class="services-container">
                                        <div class="mb-2">
                                            <label class="form-label">Inflight Wifi</label>
                                            <div class="star-rating">
                                                <input type="radio" name="wifi" id="wifi5" value="5"><label
                                                    for="wifi5">‚òÖ</label>
                                                <input type="radio" name="wifi" id="wifi4" value="4"><label
                                                    for="wifi4">‚òÖ</label>
                                                <input type="radio" name="wifi" id="wifi3" value="3" checked><label
                                                    for="wifi3">‚òÖ</label>
                                                <input type="radio" name="wifi" id="wifi2" value="2"><label
                                                    for="wifi2">‚òÖ</label>
                                                <input type="radio" name="wifi" id="wifi1" value="1"><label
                                                    for="wifi1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Time Convenient</label>
                                            <div class="star-rating">
                                                <input type="radio" name="timeConv" id="timeConv5" value="5"><label
                                                    for="timeConv5">‚òÖ</label>
                                                <input type="radio" name="timeConv" id="timeConv4" value="4"><label
                                                    for="timeConv4">‚òÖ</label>
                                                <input type="radio" name="timeConv" id="timeConv3" value="3"
                                                    checked><label for="timeConv3">‚òÖ</label>
                                                <input type="radio" name="timeConv" id="timeConv2" value="2"><label
                                                    for="timeConv2">‚òÖ</label>
                                                <input type="radio" name="timeConv" id="timeConv1" value="1"><label
                                                    for="timeConv1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Online Booking</label>
                                            <div class="star-rating">
                                                <input type="radio" name="booking" id="booking5" value="5"><label
                                                    for="booking5">‚òÖ</label>
                                                <input type="radio" name="booking" id="booking4" value="4"><label
                                                    for="booking4">‚òÖ</label>
                                                <input type="radio" name="booking" id="booking3" value="3"
                                                    checked><label for="booking3">‚òÖ</label>
                                                <input type="radio" name="booking" id="booking2" value="2"><label
                                                    for="booking2">‚òÖ</label>
                                                <input type="radio" name="booking" id="booking1" value="1"><label
                                                    for="booking1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Gate Location</label>
                                            <div class="star-rating">
                                                <input type="radio" name="gate" id="gate5" value="5"><label
                                                    for="gate5">‚òÖ</label>
                                                <input type="radio" name="gate" id="gate4" value="4"><label
                                                    for="gate4">‚òÖ</label>
                                                <input type="radio" name="gate" id="gate3" value="3" checked><label
                                                    for="gate3">‚òÖ</label>
                                                <input type="radio" name="gate" id="gate2" value="2"><label
                                                    for="gate2">‚òÖ</label>
                                                <input type="radio" name="gate" id="gate1" value="1"><label
                                                    for="gate1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Food and Drink</label>
                                            <div class="star-rating">
                                                <input type="radio" name="food" id="food5" value="5"><label
                                                    for="food5">‚òÖ</label>
                                                <input type="radio" name="food" id="food4" value="4"><label
                                                    for="food4">‚òÖ</label>
                                                <input type="radio" name="food" id="food3" value="3" checked><label
                                                    for="food3">‚òÖ</label>
                                                <input type="radio" name="food" id="food2" value="2"><label
                                                    for="food2">‚òÖ</label>
                                                <input type="radio" name="food" id="food1" value="1"><label
                                                    for="food1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Online Boarding</label>
                                            <div class="star-rating">
                                                <input type="radio" name="boarding" id="boarding5" value="5"><label
                                                    for="boarding5">‚òÖ</label>
                                                <input type="radio" name="boarding" id="boarding4" value="4"><label
                                                    for="boarding4">‚òÖ</label>
                                                <input type="radio" name="boarding" id="boarding3" value="3"
                                                    checked><label for="boarding3">‚òÖ</label>
                                                <input type="radio" name="boarding" id="boarding2" value="2"><label
                                                    for="boarding2">‚òÖ</label>
                                                <input type="radio" name="boarding" id="boarding1" value="1"><label
                                                    for="boarding1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Seat Comfort</label>
                                            <div class="star-rating">
                                                <input type="radio" name="seat" id="seat5" value="5"><label
                                                    for="seat5">‚òÖ</label>
                                                <input type="radio" name="seat" id="seat4" value="4"><label
                                                    for="seat4">‚òÖ</label>
                                                <input type="radio" name="seat" id="seat3" value="3" checked><label
                                                    for="seat3">‚òÖ</label>
                                                <input type="radio" name="seat" id="seat2" value="2"><label
                                                    for="seat2">‚òÖ</label>
                                                <input type="radio" name="seat" id="seat1" value="1"><label
                                                    for="seat1">‚òÖ</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- In-flight Services Col 2 -->
                            <div class="col-md-4">
                                <div class="card">
                                    <h4 class="section-title"><i class="bi bi-star-fill"></i> Services (Part 2)</h4>
                                    <div class="services-container">
                                        <div class="mb-2">
                                            <label class="form-label">Entertainment</label>
                                            <div class="star-rating">
                                                <input type="radio" name="entertainment" id="entertainment5"
                                                    value="5"><label for="entertainment5">‚òÖ</label>
                                                <input type="radio" name="entertainment" id="entertainment4"
                                                    value="4"><label for="entertainment4">‚òÖ</label>
                                                <input type="radio" name="entertainment" id="entertainment3" value="3"
                                                    checked><label for="entertainment3">‚òÖ</label>
                                                <input type="radio" name="entertainment" id="entertainment2"
                                                    value="2"><label for="entertainment2">‚òÖ</label>
                                                <input type="radio" name="entertainment" id="entertainment1"
                                                    value="1"><label for="entertainment1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">On-board Service</label>
                                            <div class="star-rating">
                                                <input type="radio" name="onboard" id="onboard5" value="5"><label
                                                    for="onboard5">‚òÖ</label>
                                                <input type="radio" name="onboard" id="onboard4" value="4"><label
                                                    for="onboard4">‚òÖ</label>
                                                <input type="radio" name="onboard" id="onboard3" value="3"
                                                    checked><label for="onboard3">‚òÖ</label>
                                                <input type="radio" name="onboard" id="onboard2" value="2"><label
                                                    for="onboard2">‚òÖ</label>
                                                <input type="radio" name="onboard" id="onboard1" value="1"><label
                                                    for="onboard1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Leg Room Service</label>
                                            <div class="star-rating">
                                                <input type="radio" name="legroom" id="legroom5" value="5"><label
                                                    for="legroom5">‚òÖ</label>
                                                <input type="radio" name="legroom" id="legroom4" value="4"><label
                                                    for="legroom4">‚òÖ</label>
                                                <input type="radio" name="legroom" id="legroom3" value="3"
                                                    checked><label for="legroom3">‚òÖ</label>
                                                <input type="radio" name="legroom" id="legroom2" value="2"><label
                                                    for="legroom2">‚òÖ</label>
                                                <input type="radio" name="legroom" id="legroom1" value="1"><label
                                                    for="legroom1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Baggage Handling</label>
                                            <div class="star-rating">
                                                <input type="radio" name="baggage" id="baggage5" value="5"><label
                                                    for="baggage5">‚òÖ</label>
                                                <input type="radio" name="baggage" id="baggage4" value="4"><label
                                                    for="baggage4">‚òÖ</label>
                                                <input type="radio" name="baggage" id="baggage3" value="3"
                                                    checked><label for="baggage3">‚òÖ</label>
                                                <input type="radio" name="baggage" id="baggage2" value="2"><label
                                                    for="baggage2">‚òÖ</label>
                                                <input type="radio" name="baggage" id="baggage1" value="1"><label
                                                    for="baggage1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Check-in Service</label>
                                            <div class="star-rating">
                                                <input type="radio" name="checkin" id="checkin5" value="5"><label
                                                    for="checkin5">‚òÖ</label>
                                                <input type="radio" name="checkin" id="checkin4" value="4"><label
                                                    for="checkin4">‚òÖ</label>
                                                <input type="radio" name="checkin" id="checkin3" value="3"
                                                    checked><label for="checkin3">‚òÖ</label>
                                                <input type="radio" name="checkin" id="checkin2" value="2"><label
                                                    for="checkin2">‚òÖ</label>
                                                <input type="radio" name="checkin" id="checkin1" value="1"><label
                                                    for="checkin1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Inflight Service</label>
                                            <div class="star-rating">
                                                <input type="radio" name="service" id="service5" value="5"><label
                                                    for="service5">‚òÖ</label>
                                                <input type="radio" name="service" id="service4" value="4"><label
                                                    for="service4">‚òÖ</label>
                                                <input type="radio" name="service" id="service3" value="3"
                                                    checked><label for="service3">‚òÖ</label>
                                                <input type="radio" name="service" id="service2" value="2"><label
                                                    for="service2">‚òÖ</label>
                                                <input type="radio" name="service" id="service1" value="1"><label
                                                    for="service1">‚òÖ</label>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label">Cleanliness</label>
                                            <div class="star-rating">
                                                <input type="radio" name="cleanliness" id="cleanliness5"
                                                    value="5"><label for="cleanliness5">‚òÖ</label>
                                                <input type="radio" name="cleanliness" id="cleanliness4"
                                                    value="4"><label for="cleanliness4">‚òÖ</label>
                                                <input type="radio" name="cleanliness" id="cleanliness3" value="3"
                                                    checked><label for="cleanliness3">‚òÖ</label>
                                                <input type="radio" name="cleanliness" id="cleanliness2"
                                                    value="2"><label for="cleanliness2">‚òÖ</label>
                                                <input type="radio" name="cleanliness" id="cleanliness1"
                                                    value="1"><label for="cleanliness1">‚òÖ</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-2">
                            <button type="submit" class="btn btn-predict">
                                <i class="bi bi-search"></i> PREDICT
                            </button>
                        </div>

                        <div id="result"></div>
                    </form>
                </div>
            </div>

            <!-- Batch Analysis Tab -->
            <div id="batch" class="tab-pane fade">
                <div class="row h-100">
                    <div class="col-md-12">
                        <div style="margin-bottom: 15px;">
                            <input type="file" id="csvFile" accept=".csv" style="display: none;">
                            <button type="button" class="btn btn-predict" style="padding: 6px 20px; font-size: 0.8rem;"
                                onclick="document.getElementById('csvFile').click()">
                                <i class="bi bi-cloud-upload"></i> Upload CSV File
                            </button>
                            <span style="font-size: 0.7rem; color: #666; margin-left: 10px;">
                                <strong>Required:</strong> Gender, Customer Type, Age, Type of Travel, Class, Flight Distance, Services, Delays
                            </span>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div id="batchResults" style="display: none;">
                            <!-- Section 1: Overview (T·ªïng quan) -->
                            <h4 class="section-title"><i class="bi bi-bar-chart-fill"></i> 1. T·ªïng quan (Overview)</h4>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <h6 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">Satisfaction Distribution</h6>
                                        <canvas id="satisfactionChart" style="max-height: 200px;"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <h6 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">By Class & Travel Type</h6>
                                        <canvas id="classChart" style="max-height: 200px;"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <h6 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">Age Distribution</h6>
                                        <canvas id="ageChart" style="max-height: 200px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Section 2: Summary Stats -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div style="padding: 15px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 8px; color: white; text-align: center;">
                                                    <div style="font-size: 2rem; font-weight: 700;"><span id="satisfiedCount">0</span></div>
                                                    <div style="font-size: 0.85rem;">‚úÖ Satisfied (<span id="satisfiedPct">0</span>%)</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div style="padding: 15px; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); border-radius: 8px; color: white; text-align: center;">
                                                    <div style="font-size: 2rem; font-weight: 700;"><span id="dissatisfiedCount">0</span></div>
                                                    <div style="font-size: 0.85rem;">‚ùå Dissatisfied (<span id="dissatisfiedPct">0</span>%)</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; text-align: center;">
                                                    <div style="font-size: 2rem; font-weight: 700;"><span id="totalCount">0</span></div>
                                                    <div style="font-size: 0.85rem;">üìä Total Records</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Section 3: Feature Importance -->
                            <h4 class="section-title"><i class="bi bi-graph-up"></i> 3. Y·∫øu t·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª± h√†i l√≤ng</h4>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <h6 style="color: #11998e; font-weight: 600; margin-bottom: 10px; text-align: center;">
                                            <i class="bi bi-emoji-smile"></i> Top Factors - Satisfied Customers
                                        </h6>
                                        <canvas id="topSatisfiedChart" style="max-height: 280px;"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card" style="padding: 15px; background: white;">
                                        <h6 style="color: #ee0979; font-weight: 600; margin-bottom: 10px; text-align: center;">
                                            <i class="bi bi-emoji-frown"></i> Top Factors - Dissatisfied Customers
                                        </h6>
                                        <canvas id="topDissatisfiedChart" style="max-height: 280px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h5 style="color: #667eea; font-weight: 600; margin: 0;">Preview (First 100 records)</h5>
                                    <button type="button" class="btn btn-predict" style="padding: 6px 20px; font-size: 0.8rem;" onclick="exportToExcel()">
                                        <i class="bi bi-file-earmark-excel"></i> Export to Excel
                                    </button>
                                </div>
                                <div class="table-responsive results-table">
                                    <table class="table table-sm table-striped" id="resultsTable">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Gender</th>
                                                <th>Age</th>
                                                <th>Type</th>
                                                <th>Class</th>
                                                <th>Distance</th>
                                                <th>Prediction</th>
                                                <th>Main Reason</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resultsBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="batchError" class="alert alert-danger" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Single Prediction
        function getRadioValue(name) {
            const radio = document.querySelector(`input[name="${name}"]:checked`);
            return radio ? radio.value : '3';
        }

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                gender: document.getElementById('gender').value,
                customerType: document.getElementById('customerType').value,
                age: document.getElementById('age').value,
                travelType: document.getElementById('travelType').value,
                class: document.getElementById('class').value,
                distance: document.getElementById('distance').value,
                wifi: getRadioValue('wifi'),
                timeConv: getRadioValue('timeConv'),
                booking: getRadioValue('booking'),
                gate: getRadioValue('gate'),
                food: getRadioValue('food'),
                boarding: getRadioValue('boarding'),
                seat: getRadioValue('seat'),
                entertainment: getRadioValue('entertainment'),
                onboard: getRadioValue('onboard'),
                legroom: getRadioValue('legroom'),
                baggage: getRadioValue('baggage'),
                checkin: getRadioValue('checkin'),
                service: getRadioValue('service'),
                cleanliness: getRadioValue('cleanliness'),
                depDelay: document.getElementById('depDelay').value,
                arrDelay: document.getElementById('arrDelay').value
            };

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                const resultDiv = document.getElementById('result');

                if (result.success) {
                    if (result.satisfied) {
                        resultDiv.innerHTML = `
                            <div class="result-box result-satisfied">
                                <i class="bi bi-emoji-smile-fill"></i> PASSENGER SATISFIED!
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="result-box result-dissatisfied">
                                <i class="bi bi-emoji-frown-fill"></i> PASSENGER DISSATISFIED
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger mt-3">
                            Error: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div class="alert alert-danger mt-3">
                        Connection Error: ${error.message}
                    </div>
                `;
            }
        });

        // Batch Analysis
        const csvFile = document.getElementById('csvFile');
        const batchResults = document.getElementById('batchResults');
        const batchError = document.getElementById('batchError');

        csvFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        async function handleFileUpload(file) {
            if (!file.name.endsWith('.csv')) {
                showError('Please upload a CSV file');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/predict_batch', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    displayResults(result);
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Connection error: ' + error.message);
            }
        }

        let satisfactionChart = null;
        let classChart = null;
        let ageChart = null;
        let topSatisfiedChart = null;
        let topDissatisfiedChart = null;
        let currentBatchData = null; // Store batch data for export

        function displayResults(data) {
            batchError.style.display = 'none';
            batchResults.style.display = 'block';
            
            // Store data for export
            currentBatchData = data;

            // Update stats
            document.getElementById('totalCount').textContent = data.total;
            document.getElementById('satisfiedCount').textContent = data.satisfied;
            document.getElementById('dissatisfiedCount').textContent = data.dissatisfied;
            document.getElementById('satisfiedPct').textContent = data.satisfied_percentage;
            document.getElementById('dissatisfiedPct').textContent = data.dissatisfied_percentage;

            // 1. Satisfaction Pie Chart
            const ctx1 = document.getElementById('satisfactionChart');
            if (satisfactionChart) satisfactionChart.destroy();

            satisfactionChart = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ['Satisfied', 'Dissatisfied'],
                    datasets: [{
                        data: [data.satisfied, data.dissatisfied],
                        backgroundColor: ['rgba(56, 239, 125, 0.8)', 'rgba(255, 106, 0, 0.8)'],
                        borderColor: ['rgba(56, 239, 125, 1)', 'rgba(255, 106, 0, 1)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 10 } } }
                    }
                }
            });

            // 2. Class & Travel Type Chart (using data aggregation)
            const classData = aggregateByClassAndType(data.results);
            const ctx2 = document.getElementById('classChart');
            if (classChart) classChart.destroy();

            classChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(classData),
                    datasets: [{
                        label: 'Satisfied',
                        data: Object.values(classData).map(d => d.satisfied),
                        backgroundColor: 'rgba(56, 239, 125, 0.7)'
                    }, {
                        label: 'Dissatisfied',
                        data: Object.values(classData).map(d => d.dissatisfied),
                        backgroundColor: 'rgba(255, 106, 0, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 9 } } }
                    },
                    scales: {
                        x: { ticks: { font: { size: 8 } } },
                        y: { ticks: { font: { size: 9 } } }
                    }
                }
            });

            // 3. Age Distribution (Stacked Bar Chart)
            const ageData = aggregateByAge(data.results);
            const ctx3 = document.getElementById('ageChart');
            if (ageChart) ageChart.destroy();

            ageChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: Object.keys(ageData),
                    datasets: [{
                        label: 'Satisfied',
                        data: Object.values(ageData).map(d => d.satisfied),
                        backgroundColor: 'rgba(56, 239, 125, 0.8)',
                        borderColor: 'rgba(56, 239, 125, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Dissatisfied',
                        data: Object.values(ageData).map(d => d.dissatisfied),
                        backgroundColor: 'rgba(255, 106, 0, 0.8)',
                        borderColor: 'rgba(255, 106, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 9 } } }
                    },
                    scales: {
                        x: { 
                            stacked: true,
                            ticks: { font: { size: 8 } } 
                        },
                        y: { 
                            stacked: true,
                            ticks: { font: { size: 9 } } 
                        }
                    }
                }
            });

            // 4. Top Factors Charts (separated for clarity)
            const featureData = analyzeFeatureImportance(data.results);
            
            // Top Satisfied Factors
            const ctx4a = document.getElementById('topSatisfiedChart');
            if (topSatisfiedChart) topSatisfiedChart.destroy();

            topSatisfiedChart = new Chart(ctx4a, {
                type: 'bar',
                data: {
                    labels: featureData.topSatisfied.labels,
                    datasets: [{
                        label: 'Avg Rating',
                        data: featureData.topSatisfied.values,
                        backgroundColor: 'rgba(56, 239, 125, 0.8)',
                        borderColor: 'rgba(56, 239, 125, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Rating: ' + context.parsed.x.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            min: 0, 
                            max: 5, 
                            ticks: { font: { size: 10 } },
                            title: { display: true, text: 'Average Rating', font: { size: 11 } }
                        },
                        y: { ticks: { font: { size: 10, weight: 'bold' } } }
                    }
                }
            });

            // Top Dissatisfied Factors
            const ctx4b = document.getElementById('topDissatisfiedChart');
            if (topDissatisfiedChart) topDissatisfiedChart.destroy();

            topDissatisfiedChart = new Chart(ctx4b, {
                type: 'bar',
                data: {
                    labels: featureData.topDissatisfied.labels,
                    datasets: [{
                        label: 'Avg Rating',
                        data: featureData.topDissatisfied.values,
                        backgroundColor: 'rgba(255, 106, 0, 0.8)',
                        borderColor: 'rgba(255, 106, 0, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Rating: ' + context.parsed.x.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            min: 0, 
                            max: 5, 
                            ticks: { font: { size: 10 } },
                            title: { display: true, text: 'Average Rating', font: { size: 11 } }
                        },
                        y: { ticks: { font: { size: 10, weight: 'bold' } } }
                    }
                }
            });

            // Update table
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            data.results.forEach((row, idx) => {
                const tr = document.createElement('tr');
                const predClass = row.Prediction === 'satisfied' ? 'badge-satisfied' : 'badge-dissatisfied';
                const predText = row.Prediction === 'satisfied' ? 'SATISFIED' : 'DISSATISFIED';
                const mainReason = row['Main Reason'] || 'N/A';

                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${row.Gender || ''}</td>
                    <td>${row.Age || ''}</td>
                    <td>${row['Type of Travel'] || ''}</td>
                    <td>${row.Class || ''}</td>
                    <td>${row['Flight Distance'] || ''}</td>
                    <td><span class="badge ${predClass}">${predText}</span></td>
                    <td style="font-size: 0.7rem; color: #667eea; font-weight: 600;">${mainReason}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Helper functions for data aggregation
        function aggregateByClassAndType(results) {
            const agg = {};
            results.forEach(row => {
                const key = `${row.Class || 'Unknown'}`;
                if (!agg[key]) agg[key] = { satisfied: 0, dissatisfied: 0 };
                if (row.Prediction === 'satisfied') agg[key].satisfied++;
                else agg[key].dissatisfied++;
            });
            return agg;
        }

        function aggregateByAge(results) {
            const agg = {};
            results.forEach(row => {
                const age = row.Age || 0;
                const bucket = Math.floor(age / 10) * 10;
                const label = `${bucket}-${bucket + 9}`;
                if (!agg[label]) agg[label] = { satisfied: 0, dissatisfied: 0 };
                if (row.Prediction === 'satisfied') agg[label].satisfied++;
                else agg[label].dissatisfied++;
            });
            return agg;
        }

        function analyzeFeatureImportance(results) {
            const services = [
                'Inflight wifi service', 'Departure/Arrival time convenient',
                'Ease of Online booking', 'Gate location', 'Food and drink',
                'Online boarding', 'Seat comfort', 'Inflight entertainment',
                'On-board service', 'Leg room service', 'Baggage handling',
                'Checkin service', 'Inflight service', 'Cleanliness'
            ];

            const shortNames = {
                'Inflight wifi service': 'Wifi',
                'Departure/Arrival time convenient': 'Time Convenient',
                'Ease of Online booking': 'Online Booking',
                'Gate location': 'Gate Location',
                'Food and drink': 'Food & Drink',
                'Online boarding': 'Online Boarding',
                'Seat comfort': 'Seat Comfort',
                'Inflight entertainment': 'Entertainment',
                'On-board service': 'Onboard Service',
                'Leg room service': 'Leg Room',
                'Baggage handling': 'Baggage',
                'Checkin service': 'Check-in',
                'Inflight service': 'Inflight Service',
                'Cleanliness': 'Cleanliness'
            };

            const satisfied = {};
            const dissatisfied = {};
            const countSat = {};
            const countDis = {};

            services.forEach(s => {
                satisfied[s] = 0;
                dissatisfied[s] = 0;
                countSat[s] = 0;
                countDis[s] = 0;
            });

            results.forEach(row => {
                services.forEach(service => {
                    const val = parseFloat(row[service]) || 0;
                    if (row.Prediction === 'satisfied') {
                        satisfied[service] += val;
                        countSat[service]++;
                    } else {
                        dissatisfied[service] += val;
                        countDis[service]++;
                    }
                });
            });

            // Calculate averages for satisfied customers
            const satisfiedFeatures = [];
            services.forEach(service => {
                const avg = countSat[service] > 0 ? satisfied[service] / countSat[service] : 0;
                satisfiedFeatures.push({
                    name: shortNames[service],
                    value: avg
                });
            });
            satisfiedFeatures.sort((a, b) => b.value - a.value);
            const topSatisfied = {
                labels: satisfiedFeatures.slice(0, 7).map(f => f.name),
                values: satisfiedFeatures.slice(0, 7).map(f => f.value)
            };

            // Calculate averages for dissatisfied customers (show lowest ratings)
            const dissatisfiedFeatures = [];
            services.forEach(service => {
                const avg = countDis[service] > 0 ? dissatisfied[service] / countDis[service] : 0;
                dissatisfiedFeatures.push({
                    name: shortNames[service],
                    value: avg
                });
            });
            dissatisfiedFeatures.sort((a, b) => a.value - b.value); // Sort ascending (worst first)
            const topDissatisfied = {
                labels: dissatisfiedFeatures.slice(0, 7).map(f => f.name),
                values: dissatisfiedFeatures.slice(0, 7).map(f => f.value)
            };

            return { topSatisfied, topDissatisfied };
        }

        function exportToExcel() {
            if (!currentBatchData || !currentBatchData.results) {
                alert('No data to export');
                return;
            }

            // Prepare data for Excel
            const excelData = currentBatchData.results.map((row, idx) => ({
                '#': idx + 1,
                'Gender': row.Gender || '',
                'Customer Type': row['Customer Type'] || '',
                'Age': row.Age || '',
                'Type of Travel': row['Type of Travel'] || '',
                'Class': row.Class || '',
                'Flight Distance': row['Flight Distance'] || '',
                'Wifi': row['Inflight wifi service'] || '',
                'Time Convenient': row['Departure/Arrival time convenient'] || '',
                'Online Booking': row['Ease of Online booking'] || '',
                'Gate Location': row['Gate location'] || '',
                'Food & Drink': row['Food and drink'] || '',
                'Online Boarding': row['Online boarding'] || '',
                'Seat Comfort': row['Seat comfort'] || '',
                'Entertainment': row['Inflight entertainment'] || '',
                'Onboard Service': row['On-board service'] || '',
                'Leg Room': row['Leg room service'] || '',
                'Baggage': row['Baggage handling'] || '',
                'Check-in': row['Checkin service'] || '',
                'Inflight Service': row['Inflight service'] || '',
                'Cleanliness': row['Cleanliness'] || '',
                'Departure Delay': row['Departure Delay in Minutes'] || '',
                'Arrival Delay': row['Arrival Delay in Minutes'] || '',
                'Prediction': row.Prediction || '',
                'Main Reason': row['Main Reason'] || ''
            }));

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);

            // Set column widths
            const colWidths = [
                { wch: 5 }, { wch: 10 }, { wch: 15 }, { wch: 8 }, { wch: 15 },
                { wch: 12 }, { wch: 15 }, { wch: 8 }, { wch: 15 }, { wch: 12 },
                { wch: 12 }, { wch: 12 }, { wch: 15 }, { wch: 12 }, { wch: 15 },
                { wch: 15 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 15 },
                { wch: 12 }, { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 20 }
            ];
            ws['!cols'] = colWidths;

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Predictions');

            // Generate filename with timestamp
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `airline_satisfaction_predictions_${timestamp}.xlsx`;

            // Download file
            XLSX.writeFile(wb, filename);
        }

        function showError(message) {
            batchResults.style.display = 'none';
            batchError.style.display = 'block';
            batchError.textContent = message;
        }
    </script>
</body>

</html>